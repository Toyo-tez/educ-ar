const cardData = [
  {
    title: "Musculos",
    description: "Mira los varios musculos del cuerpo humano al detalle",
    image: "img/musculos.png",
    tags: ["Biologia"],
    embedded:
      "https://sketchfab.com/models/3185924ee3c64db1be6184cc40cd212b/embed",
    juego:
      "https://es.educaplay.com/juego/21620640-desafio_del_cuerpo_humano.html",
  },
  {
    title: "El sistema digestivo",
    description:
      "Observa a lujo de detalle los organos que comprenden el sistema digestivo",
    image: "img/sistema-digestivo.png",
    tags: ["Biologia"],
    embedded:
      "https://sketchfab.com/models/f78ce703805f49d3b732e37be5b93188/embed?dnt=1",
    juego:
      "https://es.educaplay.com/juego/21620319-juego_de_desencriptar_sistema_digestivo.html",
  },
  {
    title: "Celula Procariota",
    description: "Conoce a detalle las partes de las celulas procariotas",
    image: "img/celula.png",
    tags: ["Biologia"],
    embedded:
      "https://sketchfab.com/models/eb47b67df9ca4c47b681716d572e3177/embed?dnt=1",
    juego: "https://es.educaplay.com/juego/21620674-celulas.html",
  },
  {
    title: "Celula Eucariota",
    description: "Conoce a detalle las partes de las celulas eucariotas",
    image: "img/eucariota.png",
    tags: ["Biologia"],
    embedded:
      "https://sketchfab.com/models/eb47b67df9ca4c47b681716d572e3177/embed?dnt=1",
    juego: "https://es.educaplay.com/juego/21620674-celulas.html",
  },
  {
    title: "ADN",
    description: "Observa la estructura del ADN y lo que lo compone",
    image: "img/adn.png",
    tags: ["Biologia"],
    embedded:
      "https://sketchfab.com/models/4d57784b0d4841d0ab3d43d526df1c3f/embed?dnt=1",
    juego: "https://es.educaplay.com/juego/21620291-adivina_el_adn.html",
  },
  {
    title: "Cerebro Humano",
    description: "La fuente de nuestros pensamientos...",
    image: "img/cerebro.png",
    tags: ["Biologia"],
    embedded:
      "https://sketchfab.com/models/7a27c17fd6c0488bb31ab093236a47fb/embed",
    juego:
      "https://es.educaplay.com/juego/21620176-juego_de_parejas_partes_del_cerebro.html",
  },
  {
    title: "La Columna Vertebral",
    description:
      "Mira las distintas vertebras y partes de la columna vertebral!",
    image: "img/columna.png",
    tags: ["Biologia"],
    embedded:
      "https://sketchfab.com/models/bcd9eee09ce044ef98a69c315aa792e2/embed",
    juego:
      "https://es.educaplay.com/juego/21620276-desafio_sobre_la_columna_espinal.html",
  },
  {
    title: "El Esqueleto",
    description: "Observa el esqueleto humano y donde se encuentra el corazón",
    image: "img/esqueleto.png",
    tags: ["Biologia"],
    embedded:
      "https://sketchfab.com/models/8de0ef3161c94a0787101e7618c1bc43/embed",
    juego: "https://es.educaplay.com/juego/5897394-sistema_oseo_humano.html",
  },
  {
    title: "El Coliseo Romano",
    description: "Uno de los lugares mas icónicos de la Antigua Roma",
    image: "img/coliseo.png",
    tags: ["Historia"],
    embedded:
      "https://sketchfab.com/models/535dc96e586f40bd956ea3cbff810055/embed",
    juego: "https://es.educaplay.com/juego/7569267-la_republica_romana.html",
  },
  {
    title: "Jeroglificos",
    description: "Observa un escaneo de una tabla de jeroglificos real!",
    image: "img/jeroglificos.png",
    tags: ["Historia"],
    embedded:
      "https://sketchfab.com/models/cefaad19421a48a08de3b20adf15f6a7/embed",
    juego: "https://es.educaplay.com/juego/6841614-egipto.html",
  },
  {
    title: "Sarcofagos",
    description:
      "Donde antiguamente enterraban a los faraones del viejo egipto",
    image: "img/sarcofago.png",
    tags: ["Historia"],
    embedded:
      "https://sketchfab.com/models/a764524635254898afbbbd6e62443e40/embed",
    juego: "https://es.educaplay.com/juego/6994960-egipto.html",
  },
  {
    title: "Templo Japones",
    description: "Explora la arquitectura oriental japonesa",
    image: "img/templojap.png",
    tags: ["Historia"],
    embedded:
      "https://sketchfab.com/models/5917e267ca3e48ac8a27f9ec5809fc29/embed",
    juego:
      "https://es.educaplay.com/juego/20632650-caracteristicas_de_japon.html",
  },
  {
    title: "El Primer Avión",
    description:
      "Mira las partes que comprendian el primer avión de la historia",
    image: "img/primeravion.png",
    tags: ["Historia"],
    embedded:
      "https://sketchfab.com/models/38b91a9a0e784829ba96daafa8d77f76/embed",
    juego:
      "https://es.educaplay.com/juego/21620872-desafio_wright_flyer_i.html",
  },
  {
    title: "Mapa Topológico de la Antigua Roma",
    description:
      "Un mapa de la Antigua Roma con profundidad creado por Paul Bigot entre 1908 y 1942",
    image: "img/maparoma.png",
    tags: ["Geografia", "Historia"],
    embedded:
      "https://sketchfab.com/models/2f9cb1fbc2eb470686eb8ba596b059cb/embed",
    juego: "https://es.educaplay.com/juego/7569267-la_republica_romana.html",
  },
  {
    title: "Mapa Topológico del Museo Americano",
    description:
      "Un mapa con profundidad mostrandonos como se ve por fuera el museo de historia americano",
    image: "img/museo.png",
    tags: ["Geografia"],
    embedded:
      "https://sketchfab.com/models/bf603741006c4db4a48728ac4b779a1d/embed",
    juego:
      "https://es.educaplay.com/juego/21620717-juego_de_parejas_museo_americano_de_historia.html",
  },
  {
    title: "Castillo Santiago de la Torre",
    description: "Escaneo 3D del castillo Español Santiago de la Torre",
    image: "img/castillo.png",
    tags: ["Geografia"],
    embedded:
      "https://sketchfab.com/models/746422197cdd4b8eb601774741eff01f/embed",
    juego:
      "https://es.educaplay.com/juego/21620736-completa_los_espacios_sobre_el_castillo_santiago_de_la_torre.html",
  },
  {
    title: "Fontana di Trevi",
    description:
      "Uno de los lugares de Italia más conocidos sin ser la torre de Pizza, cuenta la leyenda que si tiras una moneda volves a Roma",
    image: "img/fuente.png",
    tags: ["Geografia"],
    embedded:
      "https://sketchfab.com/3d-models/fontana-di-trevi-rome-italy-1732-36bea7ec68844e0f94f2e2effa7e05eb",
    juego:
      "https://es.educaplay.com/juego/21620756-gioco_di_anagrammi_fontana_di_trevi.html",
  },
  {
    title: "Modelos de Atómos",
    description:
      "Observa las distintas propuestas a lo largo de los años sobre el atómo y su composición",
    image: "img/atomos.png",
    tags: ["Quimica"],
    embedded:
      "https://sketchfab.com/models/27cd36666c3c4b7cafa9600d80618601/embed",
    juego: "https://es.educaplay.com/juego/21620218-modelos_atomicos.html",
  },
  {
    title: "Estructura del Aminoácido",
    description: "Observa la estructura del Aminoácido en 3D",
    image: "img/aminoacido.png",
    tags: ["Quimica"],
    embedded:
      "https://sketchfab.com/models/e59d15d7cff4406ebbaced8ee57fba54/embed",
    juego:
      "https://es.educaplay.com/juego/21620537-desafio_quimico_elementos_y_sustancias.html",
  },
  {
    title: "Estructura y polaridad del agua",
    description: "Observa la estructura y polaridad del agua en 3D",
    image: "img/agua.png",
    tags: ["Quimica"],
    embedded:
      "https://sketchfab.com/models/960db05560484053b1c7f565b16b6c7d/embed",
    juego:
      "https://es.educaplay.com/juego/21620537-desafio_quimico_elementos_y_sustancias.html",
  },
  {
    title: "Disolución",
    description: "Observa como la sal se disuelve en el agua (Animado)",
    image: "img/disolucion.png",
    tags: ["Quimica"],
    embedded:
      "https://sketchfab.com/models/246f79155c424e4ba22c9ae50532a81d/embed",
    juego:
      "https://es.educaplay.com/juego/21620537-desafio_quimico_elementos_y_sustancias.html",
  },
  {
    title: "Reacción Quimica",
    description: "Observa la reacción quimica entre Metano y Dioxigeno",
    image: "img/reaccion.png",
    tags: ["Quimica"],
    embedded:
      "https://sketchfab.com/models/aca0bf7c2d0440ae81a26ab4a0a399d2/embed",
    juego:
      "https://es.educaplay.com/juego/21620537-desafio_quimico_elementos_y_sustancias.html",
  },
  {
    title: "Elementos Químicos",
    description:
      "Mirá los distintos objetos dentro de un laboratorio, como tubos de ensayo, provetas, etc",
    image: "img/elementos.png",
    tags: ["Quimica"],
    embedded:
      "https://sketchfab.com/models/6a6dcd9617d74a3c958399500ff8c9b7/embed",
    juego:
      "https://es.educaplay.com/juego/21620586-crucigrama_de_elementos_de_laboratorio.html",
  },
];

const cardContainer = document.getElementById("card-container");
const searchInput = document.getElementById("search-input");
const filterButtons = document.querySelectorAll(".filter-btn");

// Function to create a card element
function createCardElement(data) {
  const card = document.createElement("div");
  card.classList.add("bg-white", "rounded-lg", "shadow-lg", "overflow-hidden");

  const image = document.createElement("img");
  image.src = data.image;
  image.alt = data.title;
  image.classList.add("w-full", "h-48", "object-cover");

  const content = document.createElement("div");
  content.classList.add("p-4");

  const title = document.createElement("h2");
  title.textContent = data.title;
  title.classList.add("text-lg", "font-medium");

  const description = document.createElement("p");
  description.textContent = data.description;
  description.classList.add("text-gray-600", "mt-2");

  const footer = document.createElement("div");
  footer.classList.add("flex", "justify-between", "items-center", "mt-4");

  const viewButton = document.createElement("button");
  viewButton.textContent = "Ver modelo";
  viewButton.setAttribute("type", "button"); // Evita el comportamiento de envío
  viewButton.classList.add(
    "text-teal-500",
    "hover:text-teal-600",
    "font-medium",
    "flex",
    "items-center"
  );
  viewButton.addEventListener("click", () => openModal(data));

  const subjectTag = document.createElement("span");
  subjectTag.textContent = data.tags[0];
  subjectTag.classList.add("text-gray-600");

  footer.appendChild(viewButton);
  footer.appendChild(subjectTag);

  content.appendChild(title);
  content.appendChild(description);
  content.appendChild(footer);

  card.appendChild(image);
  card.appendChild(content);

  return card;
}
const modal = document.getElementById("modelModal");
const modalTitle = document.getElementById("modalTitle");
const modalContent = document.getElementById("modalContent");
const closeModal = document.getElementById("closeModal");
const modelo = document.getElementById("modelo");
const iframe = document.getElementById("sketchfab_iframe");
const juego = document.getElementById("juego");

// Add a variable to store current model data
let currentModelData = null;

// Helper function to safely update iframe source
function updateIframeSrc(src) {
  if (!src) {
    console.error("No source URL provided");
    return false;
  }

  if (iframe) {
    iframe.src = src;
    return true;
  } else {
    console.error("Iframe element not found");
    return false;
  }
}

// Function to open the modal
function openModal(data) {
  if (!data) {
    console.error("No data provided to openModal");
    return;
  }

  // Store the current model data
  currentModelData = data;

  if (modal && modalTitle) {
    modalTitle.textContent = data.title || "Modelo sin título";

    if (updateIframeSrc(data.embedded)) {
      modal.classList.remove("hidden");
      console.log("Modal opened successfully");
    }
  } else {
    console.error("Modal elements not found");
  }
}

// Function to view model directly
function vermodelo() {
  if (!currentModelData) {
    console.error("No model data available");
    return;
  }

  if (!currentModelData.embedded) {
    console.error("No embedded URL provided");
    return;
  }

  updateIframeSrc(currentModelData.embedded);
}

// Function to view game
function verjuego() {
  if (!currentModelData) {
    console.error("No game data available");
    return;
  }

  if (!currentModelData.juego) {
    console.error("No game URL available for this model");
    return;
  }

  updateIframeSrc(currentModelData.juego);
}

// Close modal function
function closeModalHandler() {
  if (modal) {
    modal.classList.add("hidden");
    if (iframe) {
      iframe.src = ""; // Clear iframe source when closing
    }
    // Clear current model data
    currentModelData = null;
  }
}

// Add event listeners
if (closeModal) {
  closeModal.addEventListener("click", closeModalHandler);
}

// Ver Modelo 3D
if (modelo) {
  modelo.addEventListener("click", vermodelo);
}

// Ver juego
if (juego) {
  juego.addEventListener("click", verjuego);
}

// Function to filter cards based on search and tags
function filterCards() {
  const searchTerm = searchInput.value.toLowerCase();
  const activeTags = Array.from(filterButtons)
    .filter((btn) => btn.classList.contains("active"))
    .map((btn) => btn.dataset.filter);

  cardContainer.innerHTML = "";

  cardData.forEach((card) => {
    const matchesSearch = card.title.toLowerCase().includes(searchTerm);
    const matchesTag =
      activeTags.length === 0 ||
      activeTags.some((tag) => card.tags.includes(tag));

    if (matchesSearch && matchesTag) {
      cardContainer.appendChild(createCardElement(card));
    }
  });
}

// Add event listeners
searchInput.addEventListener("input", _.debounce(filterCards, 300));

filterButtons.forEach((btn) => {
  btn.addEventListener("click", () => {
    // Toggle the 'active' class instead of 'bg-gray-200'
    btn.classList.toggle("active");

    filterCards();
  });
});

// Initial render
cardData.forEach((card) => {
  cardContainer.appendChild(createCardElement(card));
});
